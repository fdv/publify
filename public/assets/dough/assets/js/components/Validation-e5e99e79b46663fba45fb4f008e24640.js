define(["jquery","DoughBaseComponent"],function(i,r){"use strict";var t,e={fieldSelector:"input, textarea, select",attributeEmpty:"data-dough-validation-empty",attributeInvalid:"data-dough-validation-invalid",rowInvalidClass:"is-errored",validationSummaryClass:"validation-summary",validationSummaryListAttribute:"data-dough-validation-summary-list",validationSummaryHiddenClass:"validation-summary--hidden",validationSummaryErrorClass:"validation-summary__error",inlineErrorClass:"js-inline-error",uiEvents:{"blur input, select, textarea":"_handleBlurEvent","keyup input, textarea":"_handleChangeEvent","change input, select":"_handleChangeEvent",submit:"_handleSubmit"}};return t=function(i,r){t.baseConstructor.call(this,i,r,e)},r.extend(t),t.prototype.init=function(i){return this.ATTRIBUTE_VALIDATORS={required:"_validateRequired",pattern:"_validatePattern",min:"_validateMin",max:"_validateMax",minlength:"_validateMinLength"},this.$el.find("["+this.config.validationSummaryListAttribute+"]").find("li").length>0?(this._unbindUiEvents(),this.enabled=!1,this):(this.$allFieldsOnPage=this.$el.find(this.config.fieldSelector),this.errors=[],this._prepareMarkup(),this.enabled=!0,this._initialisedSuccess(i),this)},t.prototype.addError=function(i){var r=this._getErrorIndexByName(i.name);return-1!==r&&this.errors.splice(r,1),this.errors.push(i),this._addAccessibility(i.$fieldGroup),this._sortErrorsByFieldDisplayOrder().refreshInlineErrors().refreshValidationSummary(),this},t.prototype.removeError=function(i){var r=this._getErrorIndexByName(i.name);return-1!==r&&this.errors.splice(r,1),this._removeAccessibility(i.$fieldGroup),this._sortErrorsByFieldDisplayOrder().refreshInlineErrors().refreshValidationSummary(),this},t.prototype.refreshInlineErrors=function(){return this.$el.find(".form__row").each(i.proxy(function(r,t){var e=i(t),a=e.find("."+this.config.inlineErrorClass),n=e.find(this.config.fieldSelector),s="",o=!1,l=[];n.each(i.proxy(function(r,t){var e=i(t),a=e.attr("name"),n=this._getErrorIndexByName(a);n>-1&&-1===i.inArray(a,l)&&(o=!0,l.push(a),s+='<p id="'+this._getInlineErrorID(a)+'" class="'+this.config.validationSummaryErrorClass+'">'+(n+1)+". "+this.errors[n].message+"</p>")},this)),o?e.addClass(this.config.rowInvalidClass):e.removeClass(this.config.rowInvalidClass),a.html(s)},this)),this},t.prototype.refreshValidationSummary=function(){var r,t="";return i.each(this.errors,i.proxy(function(i,e){r=e.name,t+='<li class="'+this.config.validationSummaryErrorClass+'"><a href="#error-'+r+'">'+e.message+"</a></li>"},this)),this.$el.find("["+this.config.validationSummaryListAttribute+"]").html(t),this.errors.length<1&&this._hideValidationSummary(),this},t.prototype.checkfieldGroupValidity=function(i){var r=this._getFieldGroup(i),t=this._getFieldGroupValidity(r);return t.hasError?this.addError(t):this.removeError(t),this},t.prototype._prepareMarkup=function(){var r=this.$el.find("."+this.config.validationSummaryClass);return r.length||this.$el.prepend('<div class="'+this.config.validationSummaryClass+" "+this.config.validationSummaryHiddenClass+'">          <ol '+this.config.validationSummaryListAttribute+"></ol>        </div>"),this.$el.find(".form__row").each(i.proxy(function(r,t){var e=i(t),a=e.find("."+this.config.inlineErrorClass);a.length||e.prepend(i('<div class="'+this.config.inlineErrorClass+'" />'))},this)),this},t.prototype._getInlineErrorID=function(i){return"error-"+i},t.prototype._addAccessibility=function(r){return r.each(i.proxy(function(r,t){var e=i(t),a=e.attr("aria-describedby")||"",n=this._getInlineErrorID(e.attr("name"));e.attr("aria-invalid","true"),-1===i.inArray(n,a)&&e.attr("aria-describedby",a+" "+n)},this)),this},t.prototype._removeAccessibility=function(r){return r.each(i.proxy(function(r,t){var e=i(t),a=e.attr("aria-describedby")||"",n=this._getInlineErrorID(e.attr("name"));e.removeAttr("aria-invalid"),e.attr("aria-describedby",a.replace(n,""))},this)),this},t.prototype._showValidationSummary=function(){return this.$el.find("."+this.config.validationSummaryClass).removeClass(this.config.validationSummaryHiddenClass),this},t.prototype._hideValidationSummary=function(){return this.$el.find("."+this.config.validationSummaryClass).addClass(this.config.validationSummaryHiddenClass),this},t.prototype._getFieldGroupValidity=function(r){var t=r.first(),e={errors:[],isEmpty:!0,isInvalid:!1,hasError:!1,message:"",name:t.attr("name"),$fieldGroup:r};return i.each(this.ATTRIBUTE_VALIDATORS,i.proxy(function(t,a){r.each(i.proxy(function(r,n){var s=i(n),o=s.attr(t);o&&e.errors.push(this[a](s,s.val(),o))},this))},this)),this._prepareFieldGroupValidity(t,e)},t.prototype._prepareFieldGroupValidity=function(r,t){return i.each(t.errors,function(i,r){"required"==r.name&&r.isEmpty!==!0&&(t.isEmpty=!1),r.isInvalid&&(t.isInvalid=!0)}),t.hasError=t.errors.length&&(t.isEmpty||t.isInvalid),t.isInvalid&&(t.message=r.attr(this.config.attributeInvalid)||r.attr(this.config.attributeEmpty)),t.isEmpty&&(t.message=r.attr(this.config.attributeEmpty)),t},t.prototype._validateRequired=function(i,r){var t={name:"required"};return i.is('[type="radio"]')&&!i.prop("checked")?t.isEmpty=!0:""==r&&(t.isEmpty=!0),t},t.prototype._validatePattern=function(i,r,t){var e={name:"pattern"};return r.match(t)||(e.isInvalid=!0),e},t.prototype._validateMin=function(i,r,t){var e={name:"min"},a=Number(r);return(isNaN(a)||t>a)&&(e.isInvalid=!0),e},t.prototype._validateMax=function(i,r,t){var e={name:"max"},a=Number(r);return(isNaN(a)||a>t)&&(e.isInvalid=!0),e},t.prototype._validateMinLength=function(i,r,t){var e={name:"minlength"};return r.length>0&&r.length<t&&(e.isInvalid=!0),e},t.prototype._getErrorIndexByName=function(r){var t=-1;return i.each(this.errors,i.proxy(function(i,e){var a=e.name;return a===r?void(t=i):void 0},this)),t},t.prototype._sortErrorsByFieldDisplayOrder=function(){var r=[],t=[];return this.$allFieldsOnPage.each(i.proxy(function(e,a){var n=i(a),s=n.attr("name"),o=this._getErrorIndexByName(s);-1!==o&&-1===i.inArray(s,t)&&(r.push(this.errors[o]),t.push(s))},this)),this.errors=r,this},t.prototype._getFieldGroup=function(i){var r=i.attr("name");return this.$allFieldsOnPage.filter('[name="'+r+'"]')},t.prototype._handleBlurEvent=function(r){this.checkfieldGroupValidity(i(r.target))},t.prototype._handleChangeEvent=function(r){var t=i(r.target);this._getErrorIndexByName(t.attr("name"))>-1&&this.checkfieldGroupValidity(t)},t.prototype._handleSubmit=function(r){this.$allFieldsOnPage.each(i.proxy(function(r,t){this.checkfieldGroupValidity(i(t))},this)),this.errors.length&&(r.preventDefault(),this._sortErrorsByFieldDisplayOrder().refreshValidationSummary()._showValidationSummary())},t});