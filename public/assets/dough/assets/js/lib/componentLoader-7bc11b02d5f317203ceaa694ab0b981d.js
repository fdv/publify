define(["jquery","rsvp"],function(e,n){"use strict";return{components:{},init:function(t){var o,i,s,r,a=this;return this.components={},t=t||e("body"),o=this._listComponentsToCreate(t),i=this._createPromises(o),s=this._createPromises(o),o.length&&(this._instantiateComponents(o,i.deferreds),n.allSettled(i.promises).then(function(e){a._checkForFailedInstantiations(e,s.deferreds),a._initialiseComponents(a.components,s.deferreds)})),r=n.allSettled(s.promises),r.then(function(){e("body").attr("data-dough-component-loader-all-loaded","yes")}),r},_checkForFailedInstantiations:function(n,t){e.each(n,function(e,n){"rejected"===n.state&&"SINGLETON-DUPLICATE"===n.reason.description&&(t[e].resolve(),t.splice(e,1))})},_listComponentsToCreate:function(n){var t,o,i,s=[];return t=n.find("[data-dough-component]"),t.each(function(){o=e(this),i=o.attr("data-dough-component").split(" "),e.each(i,function(e,n){o.is("[data-dough-"+n+'-initialised="yes"]')||s.push({$el:o,componentName:n})})}),s},_createPromises:function(t){var o={deferreds:[],promises:[]};return e.each(t,function(e){o.deferreds.push(n.defer()),o.promises.push(o.deferreds[e].promise)}),o},_instantiateComponents:function(n,t){var o=this;e.each(n,function(e,n){o._instantiateComponent(n.componentName,n.$el,t[e])})},_instantiateComponent:function(e,n,t){var o=this,i=this._parseConfig(n,e);require([e],function(s){s.isSingleton&&o.components[e]?t.reject({componentName:e,description:"SINGLETON-DUPLICATE"}):(i.componentName=e,o.components[e]||(o.components[e]=[]),o.components[e].push(new s(n,i)),t.resolve())})},_initialiseComponents:function(n,t){var o=0;e.each(n,function(n,i){e.each(i,function(e,n){try{n.init&&n.init(t[o])}catch(i){t[o].reject(i)}o++})})},_parseConfig:function(e,n){var t=e.attr("data-dough-"+this._convertComponentNameToDashed(n)+"-config");try{t=JSON.parse(t)}catch(o){t={}}return t},_convertComponentNameToDashed:function(e){var n=e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()});return n.substr(1)}}});