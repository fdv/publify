define(["jquery","DoughBaseComponent","eventsWithPromises"],function(t,s,i){"use strict";function e(s,i){return this.selectors=r,e.baseConstructor.call(this,s,i,n),this.$trigger=this.$el,this.$target=t('[data-dough-collapsable-target="'+this.$trigger.attr("data-dough-collapsable-trigger")+'"]'),this.i18nStrings=i&&i.i18nStrings?i.i18nStrings:o,this._setupAccessibility(),this.handleUIEventTracking=t.proxy(this.handleUIEventTracking,this),i&&i.forceTo&&this.toggle(i.forceTo,!1),this}var a,n={hideOnBlur:!1,forceTo:!1},r={activeClass:"is-active",inactiveClass:"is-inactive",iconClassOpen:"icon--down-chevron-blue",iconClassClose:"icon--up-chevron-blue"},o={open:"Show",close:"Hide"};return s.extend(e),a=e.prototype,a._setupAccessibility=function(){var t="data-dough-collapsable-target-"+this.$target.attr("data-dough-collapsable-target");this.$trigger.wrapInner('<button class="unstyled-button" type="button"/>'),this.$trigger.find("button").prepend('<span data-dough-collapsable-icon class="collapsable__trigger-icon icon '+r.iconClassOpen+'"></span>').append('<span class="visually-hidden" data-dough-collapsable-label>'+this.i18nStrings.open+"</span>").attr("aria-controls",t).attr("aria-expanded","false"),this.$target.attr("id",t),this.$trigger=this.$trigger.find("button")},a.init=function(t){return this.isShown=!!this.$target.hasClass(this.selectors.activeClass),this.setListeners(!0),this._initialisedSuccess(t),this},a.setListeners=function(s){return this.$trigger[s?"on":" off"]("click",t.proxy(function(){this.toggle()},this)),this},a.setTargetTrackingListeners=function(s){return t("body")[s?"on":"off"]("click touchend keyup",this.handleUIEventTracking),this},a.handleUIEventTracking=function(s){var i=t(s.target);return i.is(this.$trigger)||i.closest(this.$target).length||this.toggle("hide"),this},a.toggle=function(t,s){var e,a,n,o;return e="undefined"!=typeof t?"show"===t?"addClass":"removeClass":this.isShown?"removeClass":"addClass",this.isShown=!!this.$target[e](r.activeClass).hasClass(r.activeClass),this.$trigger[e](r.activeClass),this.isShown===!0?(a=this.i18nStrings.close,n="true",o=r.iconClassClose,s!==!1&&this.$target.attr("tabindex",-1).focus(),this.config.hideOnBlur&&this.setTargetTrackingListeners(!0)):(a=this.i18nStrings.open,n="false",o=r.iconClassOpen,this.config.hideOnBlur&&this.setTargetTrackingListeners(!1)),this.$trigger.find("[data-dough-collapsable-label]").text(a),this.$trigger.attr("aria-expanded",n),this.$trigger.find("[data-dough-collapsable-icon]").removeClass(r.iconClassOpen+" "+r.iconClassClose).addClass(o),"undefined"==typeof t&&i.publish("toggler:toggled",{emitter:this,visible:this.isShown}),this},e});